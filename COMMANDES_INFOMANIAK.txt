â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                      â•‘
â•‘        ğŸš€ COMMANDES Ã€ EXÃ‰CUTER SUR INFOMANIAK                        â•‘
â•‘                                                                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


âœ… GIT PUSH EFFECTUÃ‰ !
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Les modifications ont Ã©tÃ© envoyÃ©es sur Git :
  âœ… DÃ©tection automatique de l'API (import.meta.env.DEV)
  âœ… Nouveau build gÃ©nÃ©rÃ© (index-BqkPABoM.js)
  âœ… Tous les composants (HÃ´tel, Repas, Voyage)
  âœ… Backend avec statistiques enfants par Ã¢ge
  âœ… Serveur unifiÃ© (server-unified.js)


ğŸ“‹ COMMANDES SUR INFOMANIAK (SSH)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Connectez-vous en SSH Ã  votre serveur, puis :

# 1. ALLER DANS LE DOSSIER DU SITE
cd /sites/wedding.pacifico.dev
# (ou le chemin exact de votre site)


# 2. RÃ‰CUPÃ‰RER LES MODIFICATIONS
git pull


# 3. INSTALLER LES DÃ‰PENDANCES (si nÃ©cessaire)
npm install


# 4. REBUILDER LE FRONTEND SUR LE SERVEUR
npm run build


# 5. REDÃ‰MARRER LE SERVEUR
pm2 restart wedding

# OU si vous n'utilisez pas PM2 :
# killall node
# npm start &


# 6. VÃ‰RIFIER
curl http://localhost:3000/api/health


ğŸ¯ RÃ‰SULTAT ATTENDU
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

AprÃ¨s ces commandes :
  âœ… Le serveur a les derniÃ¨res modifications
  âœ… Le nouveau dist/ est gÃ©nÃ©rÃ© avec la correction
  âœ… Le site utilise window.location.origin en production
  âœ… Plus d'erreur CORS !


ğŸ§ª TEST FINAL
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. Videz le cache du navigateur :
   Ctrl + Shift + Delete â†’ "Images et fichiers en cache"

2. Ou rechargez sans cache :
   Ctrl + Shift + R

3. Allez sur :
   https://wedding.pacifico.dev/admin

4. Ouvrez la console (F12) â†’ Network

5. Tentez de vous connecter

6. VÃ©rifiez l'URL :
   âœ… DEVRAIT ÃŠTRE : https://wedding.pacifico.dev/api/admin/login
   âŒ PLUS : http://localhost:3001/api/admin/login


âœ¨ NOUVEAU FICHIER GÃ‰NÃ‰RÃ‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Ancien : index-1YgKngss.js
Nouveau : index-BqkPABoM.js  â† Nouveau hash confirme le changement !


ğŸ’¡ CE QUI A CHANGÃ‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

AVANT :
const API_URL = import.meta.env.VITE_API_URL || "http://localhost:3001";
  â†“
Toujours localhost:3001 âŒ

MAINTENANT :
const getApiUrl = () => {
  if (import.meta.env.VITE_API_URL) return import.meta.env.VITE_API_URL;
  if (import.meta.env.DEV) return 'http://localhost:3001';  // DEV
  return window.location.origin;                            // PROD
};
  â†“
En dev : localhost:3001 âœ…
En prod : window.location.origin (wedding.pacifico.dev) âœ…


ğŸ” VÃ‰RIFICATION API (DÃ‰JÃ€ FAITE)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… https://wedding.pacifico.dev/api/health
   {"status":"OK","timestamp":"2025-12-03T12:00:22.268Z"}

L'API fonctionne parfaitement !


âš ï¸ IMPORTANT
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Sur Infomaniak, aprÃ¨s "git pull", vous DEVEZ faire "npm run build" !

Pourquoi ?
  â€¢ Git ne contient PAS le dossier dist/
  â€¢ Le build doit Ãªtre fait sur le serveur
  â€¢ C'est le dist/ qui gÃ©nÃ¨re index-BqkPABoM.js avec la correction


ğŸ“‹ CHECKLIST COMPLÃˆTE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Sur Infomaniak (SSH) :
  [ ] cd /sites/wedding.pacifico.dev
  [ ] git pull
  [ ] npm install (si nouveaux packages)
  [ ] npm run build  âš ï¸ CRITIQUE !
  [ ] pm2 restart wedding
  [ ] curl http://localhost:3000/api/health

Sur votre navigateur :
  [ ] Vider le cache (Ctrl + Shift + Delete)
  [ ] Ou rechargement dur (Ctrl + Shift + R)
  [ ] https://wedding.pacifico.dev/admin
  [ ] Tester la connexion
  [ ] VÃ©rifier dans Network que l'URL est correcte


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

TOUT EST PRÃŠT ! ExÃ©cutez simplement ces commandes sur Infomaniak ! ğŸš€

